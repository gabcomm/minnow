---
title: "Minnow Project"
author: "Gabriella Commisso"
date: "2024-06-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r loading required packages}
require(fishtree)
require(phytools)
require(geiger)
require(ape)
require(geomorph)
require(ggplot2)
```

```{r loading dataset and checking phylogenetics}

#reading Rabosky et al. 2018 tree
tree<-fishtree_phylogeny()

#uploading data
minnow_data <- readxl::read_xlsx("C:/Users/Test 1/OneDrive/Documents/AbCav Project/data_ouwie.xlsx")

#checking data against tree
rownames(minnow_data) <- minnow_data$Species
d<-name.check(tree, minnow_data) 
d

#dropping excess species
phy.mcc <- drop.tip(tree,d$tree_not_data)
plot(phy.mcc, cex = 0.8)
write.nexus(phy.mcc, file = "C:/Users/Test 1/OneDrive/Documents/AbCav Project/droptiptree.nexus", translate = TRUE)
```

```{r labelling variables}
size<-minnow_data$`Standard Length`
names(size)<-rownames(minnow_data)
maxlgn<-minnow_data$`Max Length`
names(maxlgn)<-rownames(minnow_data)
diet<-minnow_data$Trophic
names(diet)<-rownames(minnow_data)
acv <- minnow_data$ABV
names(acv) <- rownames(minnow_data)
itl <- minnow_data$`Intestine Length`
names(itl) <- rownames(minnow_data)
acv.log <- minnow_data$ABV_log
names(acv.log) <- rownames(minnow_data)
itl.log <- minnow_data$IL_log
names(itl.log) <- rownames(minnow_data)
sc.itl <- minnow_data$IL_resid
names(sc.itl) <- rownames(minnow_data)
sc.acv <- minnow_data$ABV_resid
names(sc.acv) <- rownames(minnow_data)
```


```{r ggplot body length vs intestine length}
pglsmodel1<-procD.pgls(itl.log ~ log(size), phy=phy.mcc, iter = 10000)
summary(pglsmodel1)
coef1 <- coefficients(pglsmodel1)
intercept1<-coef1[1] 
slope1<- coef1[2]
reg1<-ggplot(minnow_data,aes(log(size),itl.log, color=Trophic))+
  scale_color_manual(values = c("HD" = "#33a02c", "AquaticInvertivore"="#b2df8a", "Omnivore"="grey", "AquaticInsectivore"="#a6cee3", "InsectLarvaphage"="#1f78b4", "Carnivore"="black"))+
  geom_point(size=2.5)+
  geom_abline(intercept = intercept1, slope = slope1, color="red")+ 
  ylab("Log-Int Length (mm)")+
  xlab("Log-Body Length (mm)")
reg1
```

```{r ggplot body length vs abdominal cavity volume}
pglsmodel2<-procD.pgls(acv.log ~ log(size), phy=phy.mcc, iter = 10000)
summary(pglsmodel2)
coef2 <- coefficients(pglsmodel2)
intercept2<-coef2[1] 
slope2<- coef2[2]
reg2<-ggplot(minnow_data,aes(log(size),acv.log, color=Trophic))+
  scale_color_manual(values = c("HD" = "#33a02c", "AquaticInvertivore"="#b2df8a", "Omnivore"="grey", "AquaticInsectivore"="#a6cee3", "InsectLarvaphage"="#1f78b4", "Carnivore"="black"))+
  geom_point(size=2.5)+
  geom_abline(intercept = intercept2, slope = slope2, color="red")+ 
  ylab("Log-AbCav Vol (mm3)")+
  xlab("Log-Body Length (mm)")
reg2
```

```{r ggplot intestine length vs abdominal cavity volume}
pglsmodel3<-procD.pgls(acv.log ~ itl.log, phy=phy.mcc, iter = 10000)
summary(pglsmodel3)
coef3 <- coefficients(pglsmodel3)
intercept3<-coef3[1] 
slope3<- coef3[2]
reg3<-ggplot(minnow_data,aes(itl.log, acv.log, color=Trophic))+
  scale_color_manual(values = c("HD" = "#33a02c", "AquaticInvertivore"="#b2df8a", "Omnivore"="grey", "AquaticInsectivore"="#a6cee3", "InsectLarvaphage"="#1f78b4", "Carnivore"="black"))+
  geom_point(size=2.5)+
  geom_abline(intercept = intercept3, slope = slope3, color="red")+ 
  ylab("Log-AbCav Vol (mm3)")+
  xlab("Log-Int Length (mm)")
reg3
```

```{r creating figure for paper}
library(ggpubr)
reg_figure <- ggarrange(reg1, reg2, reg3,
                    labels = c("a", "b", "c"),
                    ncol = 1, nrow = 3)
reg_figure

```

```{r intestine length/trophic group}
boxplot(sc.itl ~ minnow_data$Trophic,
        xaxt = "n",
        data = minnow_data,
        main = "Intestine Length",
        xlab = "Trophic Group",
        ylab = "Size-Corrected Intestine Length",
        col = c("#a6cee3", "#b2df8a", "#363636", "#33a02c", "#1f78b4", "grey"),
        names = c("Aq. Insectivore","Aq. Invertivore","Carnivore", "HD", "Insect Larvaphage", "Omnivore"))
legend(x = "bottom", cex = 1, horiz=TRUE, inset=c(0, -.15), xpd=TRUE,
       legend=c("Herbivore-Detritivore", "Aquatic Invertivore", "Aquatic Insectivore", "Insect Larvaphage", "Omnivore", "Carnivore"), 
       fill = c("#33a02c", "#b2df8a", "#a6cee3", "#1f78b4", "grey", "#363636"))
eco<-minnow_data$Trophic
names(eco)<-rownames(minnow_data)
trophic.anova<-procD.pgls(sc.itl~eco, phy=phy.mcc, iter = 10000)
summary(trophic.anova)
gp <-  interaction (eco)
PW <- pairwise(trophic.anova, groups = gp, covariate = NULL)
summary(PW)
```

```{r size-corrected ab cav/trophic group}
boxplot(sc.acv ~ minnow_data$Trophic,
        xaxt = "n",
        data = minnow_data,
        main = "Abdominal Cavity Volume",
        xlab = "Trophic Group",
        ylab = "Size-Corrected Abdominal Cavity Volume",
        col = c("#a6cee3", "#b2df8a", "#363636", "#33a02c", "#1f78b4", "grey"),
        names = c("Aq. Insectivore","Aq. Invertivore","Carnivore", "HD", "Insect Larvaphage", "Omnivore"))
legend(x = "topleft", title="Legend", cex = 0.6,
       legend=c("Herbivore-Detritivore", "Aquatic Invertivore", "Aquatic Insectivore", "Insect Larvaphage", "Omnivore", "Carnivore"), 
       fill = c("#33a02c", "#b2df8a", "#a6cee3", "#1f78b4", "grey", "#363636"))
eco<-minnow_data$Trophic
names(eco)<-rownames(minnow_data)
trophic.anova<-procD.pgls(sc.acv~eco, phy=phy.mcc, iter = 10000)
summary(trophic.anova)
gp <-  interaction (eco)
PW <- pairwise(trophic.anova, groups = gp, covariate = NULL)
summary(PW)
```

```{r measured body length/trophic group}
boxplot(log(size) ~ minnow_data$Trophic,
        xaxt = "n",
        data = minnow_data,
        main = "Body Length by Trophic Group",
        xlab = "Trophic Group",
        ylab = "Body Length Log",
        col = c("#a6cee3", "#b2df8a", "black", "#33a02c", "#1f78b4", "grey"),
        names = c("Aq. Insectivore","Aq. Invertivore","Carnivore", "HD", "Insect Larvaphage", "Omnivore"))
legend(x = "topleft", title="Legend", cex = 0.6,
       legend=c("Herbivore-Detritivore", "Aquatic Invertivore", "Aquatic Insectivore", "Insect Larvaphage", "Omnivore", "Carnivore"), 
       fill = c("#33a02c", "#b2df8a", "#a6cee3", "#1f78b4", "grey", "black"))
eco<-minnow_data$Trophic
names(eco)<-rownames(minnow_data)
trophic.anova<-procD.pgls(log(size)~eco, phy=phy.mcc, iter = 10000)
summary(trophic.anova)
gp <-  interaction (eco)
PW <- pairwise(trophic.anova, groups = gp, covariate = NULL)
summary(PW)
```

```{r max body length/trophic}
boxplot(log(maxlgn) ~ minnow_data$Trophic,
        xaxt = "n",
        data = minnow_data,
        main = "Maximum Body Length",
        xlab = "Trophic Group",
        ylab = "Log-adjusted Maximum Body Length (mm)",
        col = c("#a6cee3", "#b2df8a", "#363636", "#33a02c", "#1f78b4", "grey"),
        names = c("Aq. Insectivore","Aq. Invertivore","Carnivore", "HD", "Insect Larvaphage", "Omnivore"))
legend(x = "topleft", title="Legend", cex = 0.6,
       legend=c("Herbivore-Detritivore", "Aquatic Invertivore", "Aquatic Insectivore", "Insect Larvaphage", "Omnivore", "Carnivore"), 
       fill = c("#33a02c", "#b2df8a", "#a6cee3", "#1f78b4", "grey", "#363636"))
eco<-minnow_data$Trophic
names(eco)<-rownames(minnow_data)
trophic.anova<-procD.pgls(log(maxlgn)~eco, phy=phy.mcc, iter = 10000)
summary(trophic.anova)
gp <-  interaction (eco)
PW <- pairwise(trophic.anova, groups = gp, covariate = NULL)
summary(PW)
```